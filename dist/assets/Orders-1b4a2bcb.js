var V=(y,h,p)=>new Promise((x,P)=>{var D=r=>{try{T(p.next(r))}catch(C){P(C)}},b=r=>{try{T(p.throw(r))}catch(C){P(C)}},T=r=>r.done?x(r.value):Promise.resolve(r.value).then(D,b);T((p=p.apply(y,h)).next())});import{s as we,a as ke}from"./index-4deb7771.js";import{s as Te}from"./index-e8c6c15e.js";import{s as Ce,a as Se}from"./index-ee778744.js";import{s as Ie}from"./index-34321c27.js";import{s as Pe}from"./index-526b6215.js";import{s as De}from"./index-b7762fe3.js";import{s as Ue,a as Ae}from"./index-684d545a.js";import{a0 as $e,a1 as F,a2 as J,p as Oe,v as S,W as Le,a3 as Ne,q as W,X,S as Re,c as k,h as t,a as o,k as O,w as l,x as i,N as q,K as Be,o as f,P as _,t as d,n as K,O as Z,M as je,L as z,Y as u,$ as m,ab as He}from"./index-8a1dcdcd.js";import{s as Me,a as Fe}from"./index-189d15a3.js";import{s as We}from"./index-455540ca.js";import{_ as qe}from"./TopBreadcrumb-57703fde.js";import{s as ee,a as te,b as ae,c as oe}from"./index-c1748d2c.js";import{s as Ke}from"./index-87fe3aea.js";import{s as E}from"./index-59f565dc.js";import{s as ze}from"./index-4a43c2c9.js";import{V as Ee,s as le}from"./index-cc4280e2.js";import"./index-dcc24176.js";import"./index-ce2c0f14.js";import"./index-c24beee9.js";import"./index-d13f15b5.js";import"./index-f8d535e2.js";import"./_plugin-vue_export-helper-c27b6911.js";const Ye=$e("OrderStore",{state:()=>({isLoading:!1,allOrder:[],detail:null}),actions:{fetchOrder(){return V(this,null,function*(){this.isLoading=!0;try{const y=yield F.get("/auth/orders");this.allOrder=y.data}catch(y){}finally{this.isLoading=!1}})},acceptOrder(y,h){return V(this,null,function*(){this.isLoading=!0;try{const p=yield F.post("/auth/order/confirmation",{vendor_id:y,order_id:h});J("success",p.message)}catch(p){}finally{this.isLoading=!1}})},rejectOrder(y,h,p){return V(this,null,function*(){this.isLoading=!0;try{const x=yield F.post("/auth/order/reject",{vendor_id:y,order_id:h,reason:p});J("success",x.message)}catch(x){}finally{this.isLoading=!1}})}}}),Ge={class:"card mt-8"},Qe={class:"flex flex-col md:flex-row justify-between gap-4"},Je={class:"flex items-center gap-4 md:order-2 order-1"},Xe={class:"hidden md:flex"},Ze={class:"flex md:hidden"},et={class:"text-start"},tt={class:"m-0"},at={class:"m-0 text-sm text-muted-color"},ot={class:"flex flex-col gap-4 w-[25rem]"},lt={class:"flex gap-4 items-center"},st={class:"flex flex-col gap-2"},nt={class:"flex items-center justify-start gap-4"},rt=["src","alt"],it={class:"flex flex-col items-start text-start gap-4"},dt={class:"inline-flex"},ct={class:"flex flex-col gap-1"},ut={class:"m-0 font-medium"},pt={class:"flex items-center gap-2"},mt={class:"m-0"},vt={class:"flex items-center gap-2"},ft={class:"flex items-center gap-2"},_t={class:"m-0"},yt={class:"flex items-center gap-2"},gt={class:"m-0"},ht={class:"m-0"},bt={class:"flex items-center gap-2"},Vt={key:0},xt={key:1},wt={class:"flex gap-4 items-center"},kt={class:"flex flex-col gap-4"},Tt={class:"flex flex-col gap-2"},Ct={class:"flex gap-2 justify-end"},Qt=Oe({__name:"Orders",setup(y){S({});const h=S(),p=S(),x=Le(),P=Ne(),D=S(),b=Ye(),T=Ee(),r=W({vendor:null,reason:""}),C=S(0),U=S({global:{value:null,matchMode:u.CONTAINS},noInvoice:{operator:m.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},"user.name":{operator:m.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},"user.email":{operator:m.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},"user.phone":{operator:m.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},"service.name":{operator:m.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},"properties.name":{operator:m.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},location:{operator:m.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},vendor:{operator:m.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},total_fee:{operator:m.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},date:{operator:m.AND,constraints:[{value:null,matchMode:u.DATE_IS}]},status:{operator:m.OR,constraints:[{value:null,matchMode:u.EQUALS}]},paymentMethod:{operator:m.OR,constraints:[{value:null,matchMode:u.EQUALS}]}}),se=W(["order_confirmed","in_process","on_the_way","work_started","waiting_for_payment","completed"]),ne=W(["Transfer Bank","Virtual Account(VA)","GoPay","OVO"]);function L(n){switch(n){case"order_confirmed":return"contrast";case"in_process":return"warn";case"on_the_way":return"info";case"work_started":return"help";case"waiting_for_payment":return"secondary";case"completed":return"success";default:return"default"}}function N(n){switch(n){case"order_confirmed":return"Pesanan Terkonfirmasi";case"in_process":return"Pesanan Diproses";case"on_the_way":return"Menuju Lokasi";case"work_started":return"Sedang Dikerjakan";case"waiting_for_payment":return"Menunggu Pembayaran";case"completed":return"Selesai";default:return"-"}}function re(n){switch(n){case 0:return"Tidak Butuh Tangga";case 1:return"Butuh Tangga";default:return null}}const ie=X(()=>T.vendors.map(n=>({id:n.id,code:n.id,name:n.name,location:n.address,date:n.created_at,status:n.deleted_at,city:n.city,services:n.vendor_service}))),de=X(()=>b.allOrder||[]);function Y(){return V(this,null,function*(){yield b.fetchOrder(),C.value+=1})}Re(()=>V(this,null,function*(){yield b.fetchOrder(),yield T.fetchVendor()}));function ce(n){return new Date(n).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"})}const ue=n=>{x.require({target:n.currentTarget,message:"Yakin ingin membatalkan pesanan ini?",icon:"pi pi-info-circle",rejectProps:{label:"Batal",severity:"secondary",outlined:!0},acceptProps:{label:"Yakin",severity:"danger"},accept:()=>V(this,null,function*(){yield b.rejectOrder(r.vendor.id,n,r.reason),yield Y()}),reject:()=>{}})},pe=n=>{if(!r.vendor||!r.vendor.name)return P.add({severity:"error",summary:"Error",detail:"Vendor belum dipilih"});x.require({target:n.currentTarget,message:`Yakin ingin meneruskan pesanan ini kepada vendor '${r.vendor.name}'?`,icon:"pi pi-info-circle",rejectProps:{label:"Batal",severity:"secondary",outlined:!0},acceptProps:{label:"Teruskan",severity:"success"},accept:()=>V(this,null,function*(){yield b.acceptOrder(r.vendor.id,n),yield Y()}),reject:()=>{}})},me=n=>{h.value.toggle(n)},G=n=>{p.value.toggle(event)},ve=n=>{D.value.exportCSV()};return(n,a)=>{const fe=qe,c=Ce,_e=Me,w=We,ye=Fe,v=ke,A=He,ge=Ue,he=Ae,Q=De,$=Pe,R=Ie,be=Se,B=Te,Ve=we,j=Be("tooltip");return f(),k(q,null,[t(fe,{breadcrumbItems:[{label:"Pesanan"}]}),o("div",Ge,[a[23]||(a[23]=o("div",{class:"font-semibold text-xl mb-4"},"Data Pesanan",-1)),(f(),O(Ve,{ref_key:"dt",ref:D,key:C.value,value:i(de),paginator:!0,rows:10,dataKey:"id",filters:U.value,"onUpdate:filters":a[5]||(a[5]=e=>U.value=e),filterDisplay:"menu",loading:i(b).isLoading,globalFilterFields:["noInvoice","user.name","user.email","user.phone","items","location","service.name","properties.name","total_fee","vendor","date","status"],showGridlines:"",scrollable:""},{header:l(()=>[o("div",Qe,[t(c,{type:"button",icon:"pi pi-plus",label:"Tambah Pesanan",class:"md:order-1 order-2",as:"router-link",to:{name:"orders-add"}}),o("div",Je,[o("div",Xe,[t(c,{type:"button",icon:"pi pi-download",outlined:"",label:"Unduh",onClick:a[0]||(a[0]=e=>ve(e))})]),o("div",Ze,[t(c,{type:"button",icon:"pi pi-download",outlined:""})]),t(ye,{class:"w-full md:w-auto"},{default:l(()=>[t(_e,null,{default:l(()=>a[6]||(a[6]=[o("i",{class:"pi pi-search"},null,-1)])),_:1}),t(w,{modelValue:U.value.global.value,"onUpdate:modelValue":a[1]||(a[1]=e=>U.value.global.value=e),placeholder:"Pencarian",fluid:""},null,8,["modelValue"])]),_:1})])])]),empty:l(()=>a[7]||(a[7]=[_(" No order found. ")])),loading:l(()=>a[8]||(a[8]=[_(" Loading order data. Please wait. ")])),default:l(()=>[t(v,{sortable:"",field:"noInvoice",header:"Invoice",class:"min-w-[15rem]"},{body:l(({data:e})=>[_(d(e.invoice),1)]),filter:l(({filterModel:e})=>[t(w,{modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,type:"text",placeholder:"Cari Invoice"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(v,{sortable:"",field:"user.name",header:"Pelanggan",class:"min-w-[15rem]"},{body:l(({data:e})=>[o("div",et,[o("h6",tt,d(e.user.name),1),o("p",at,d(e.user.email),1),o("p",{class:"m-0 text-sm text-primary cursor-pointer hover:text-primary-300 transition-all max-w-fit",onClick:me},[_(d(e.user.phone),1),a[9]||(a[9]=o("i",{class:"pi pi-angle-down ml-2",style:{"font-size":"0.8rem"}},null,-1))]),t(i(le),{ref_key:"opPhone",ref:h},{default:l(()=>[o("div",ot,[o("div",null,[a[10]||(a[10]=o("h6",{class:"mb-0"},"Opsi Nomor Telepon",-1)),t(A)]),t(he,null,{default:l(()=>[t(w,{value:e.user.phone,readonly:"",class:"w-[25rem]"},null,8,["value"]),t(ge,null,{default:l(()=>[t(c,{icon:"pi pi-phone"})]),_:1})]),_:2},1024),o("div",lt,[t(A),a[11]||(a[11]=o("p",{class:"m-0 text-center text-muted-color text-sm"},"Atau",-1)),t(A)]),o("div",st,[a[12]||(a[12]=o("label",{for:"message"},"Kirim Pesan",-1)),t(Q,{id:"message"})]),t(c,{icon:"pi pi-send",label:"Kirim Pesan",iconPos:"right"})])]),_:2},1536)])]),filter:l(({filterModel:e})=>[t(w,{modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,type:"text",placeholder:"Cari Pelanggan"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(v,{sortable:"",header:"Lokasi",filterField:"location",class:"min-w-[24rem]"},{body:l(({data:e})=>[_(d(e.location),1)]),filter:l(({filterModel:e})=>[t(w,{modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,type:"text",placeholder:"Cari Kota"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(v,{sortable:"",header:"Layanan",filterField:"service.name",class:"min-w-[40rem]"},{body:l(({data:e})=>[t(i(ee),{value:"0"},{default:l(()=>[t(i(te),{value:"1",class:"accordion-table"},{default:l(()=>[t(i(ae),null,{default:l(()=>[o("div",nt,[e.service.full_image_url?(f(),k("img",{key:0,src:e.service.full_image_url,alt:e.service.name,class:"h-6 text-sm font-normal"},null,8,rt)):K("",!0),o("span",null,d(e.service.name),1)])]),_:2},1024),t(i(oe),null,{default:l(()=>[t(A),t(i(ee),{value:"0"},{default:l(()=>[(f(!0),k(q,null,Z(e.problems,(s,I)=>(f(),O(i(te),{key:s.name,value:I},{default:l(()=>[t(i(ae),{class:je({"accordion-subheader":e.service.image_url})},{default:l(()=>[_(d(s.name),1)]),_:2},1032,["class"]),t(i(oe),{class:"accordion-content"},{default:l(()=>[o("div",it,[(f(!0),k(q,null,Z(s.sub_problem,(g,xe)=>(f(),k("ol",{key:xe,class:"list-disc list-inside"},[o("li",null,[o("div",dt,[o("div",ct,[o("p",ut,"Kategori: "+d(g.name),1),o("div",pt,[a[16]||(a[16]=o("p",{class:"m-0"},"QTY:",-1)),t(R,{class:"inplace-custom-display"},{display:l(()=>[o("p",mt,[_(d(g.qty),1),a[13]||(a[13]=o("i",{class:"pi pi-pencil ml-2"},null,-1))])]),content:l(({closeCallback:H})=>[o("div",vt,[t($,{modelValue:g.qty,"onUpdate:modelValue":M=>g.qty=M,inputId:"horizontal-buttons",showButtons:"",buttonLayout:"horizontal",min:0,max:99,inputClass:" text-center border-l border-l-red-500 border-r border-r-green-500 bg-transparent max-w-[4rem]",incrementButtonClass:"border-green-500",decrementButtonClass:"border-red-500",small:""},{incrementbuttonicon:l(()=>a[14]||(a[14]=[o("span",{class:"pi pi-plus"},null,-1)])),decrementbuttonicon:l(()=>a[15]||(a[15]=[o("span",{class:"pi pi-minus"},null,-1)])),_:2},1032,["modelValue","onUpdate:modelValue"]),t(c,{icon:"pi pi-check",outlined:"",severity:"success",onClick:H},null,8,["onClick"])])]),_:2},1024)]),o("div",ft,[a[18]||(a[18]=o("p",{class:"m-0"},"Harga:",-1)),t(R,{class:"inplace-custom-display"},{display:l(()=>[o("p",_t,[_("Rp"+d(n.formatPrice(g.price)),1),a[17]||(a[17]=o("i",{class:"pi pi-pencil ml-2"},null,-1))])]),content:l(({closeCallback:H})=>[o("div",yt,[t($,{modelValue:g.price,"onUpdate:modelValue":M=>g.price=M,type:"text",placeholder:"Cari Harga",inputId:"currency-indonesia",mode:"currency",currency:"IDR",locale:"id-ID",minFractionDigits:0},null,8,["modelValue","onUpdate:modelValue"]),t(c,{icon:"pi pi-check",outlined:"",severity:"success",onClick:H},null,8,["onClick"])])]),_:2},1024)])])])])]))),128))])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),t(v,{field:"properties.name",header:"Jenis Property",class:"min-w-[15rem]",sortable:""},{body:l(({data:e})=>{var s;return[o("div",null,[o("p",gt,d(e.properties.name),1),e.isLadderRequired?(f(),O(be,{key:0,value:(s=re(e.isLadderRequired))!=null?s:"",size:"small",class:"mb-2"},null,8,["value"])):K("",!0),t(R,{class:"inplace-custom-display"},{display:l(()=>[o("p",ht,[_("Rp"+d(n.formatPrice(e.properties.fee)),1),a[19]||(a[19]=o("i",{class:"pi pi-pencil ml-2"},null,-1))])]),content:l(({closeCallback:I})=>[o("div",bt,[t($,{modelValue:e.properties.fee,"onUpdate:modelValue":g=>e.properties.fee=g,type:"text",placeholder:"Cari Harga",inputId:"currency-indonesia",mode:"currency",currency:"IDR",locale:"id-ID",minFractionDigits:0},null,8,["modelValue","onUpdate:modelValue"]),t(c,{icon:"pi pi-check",outlined:"",severity:"success",onClick:I},null,8,["onClick"])])]),_:2},1024)])]}),filter:l(({filterModel:e})=>[t(w,{modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,type:"text",placeholder:"Cari Property"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(v,{sortable:"",field:"total_fee",header:"Total Harga",class:"min-w-[15rem]"},{body:l(({data:e})=>[e.total_fee?(f(),k("span",Vt,"Rp"+d(n.formatPrice(e.total_fee)),1)):(f(),k("span",xt,"Harga belum ditentukan"))]),filter:l(({filterModel:e})=>[t($,{modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,type:"text",placeholder:"Cari Harga",inputId:"currency-indonesia",mode:"currency",currency:"IDR",locale:"id-ID",minFractionDigits:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(v,{sortable:"",header:"Status",field:"status",filterMenuStyle:{width:"18rem"},class:"min-w-[20rem]"},{body:l(({data:e})=>[t(B,{value:N(e.status),severity:L(e.status),class:"whitespace-nowrap"},null,8,["value","severity"])]),filter:l(({filterModel:e})=>[t(i(E),{modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,options:se,placeholder:"Pilih",showClear:""},{value:l(s=>[s.value!=null?(f(),O(B,{key:0,value:N(s.value),severity:L(s.value)},null,8,["value","severity"])):K("",!0)]),option:l(s=>[t(B,{value:N(s.option),severity:L(s.option)},null,8,["value","severity"])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),t(v,{sortable:"",field:"paymentMethod",header:"Metode Pembayaran",class:"min-w-[15rem]"},{body:l(({data:e})=>a[20]||(a[20]=[_(" Bank Transfer ")])),filter:l(({filterModel:e})=>[t(i(E),{modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,options:ne,placeholder:"Pilih",showClear:""},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),t(v,{sortable:"",field:"vendor",header:"Vendor Pilihan",class:"min-w-[15rem]"},{body:l(({data:e})=>{var s;return[t(i(E),{modelValue:r.vendor,"onUpdate:modelValue":a[2]||(a[2]=I=>r.vendor=I),options:i(ie),value:(s=e==null?void 0:e.vendor_id)==null?void 0:s.name,filter:"",optionLabel:"name",placeholder:"Pilih Vendor",class:"w-[15rem]"},null,8,["modelValue","options","value"])]}),filter:l(({filterModel:e})=>[t(w,{modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,type:"text",placeholder:"Cari Vendor"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(v,{sortable:"",header:"Tanggal Pesanan",filterField:"date",dataType:"date",class:"min-w-[20rem]"},{body:l(({data:e})=>[_(d(ce(e.created_at)),1)]),filter:l(({filterModel:e})=>[t(i(Ke),{modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(v,{sortable:"",field:"id",header:"Action",bodyClass:"text-center",class:"min-w-[10rem]"},{body:l(({data:e})=>[o("div",wt,[z(t(c,{icon:"pi pi-external-link",severity:"info",text:"",as:"router-link",to:{name:"order-detail",params:{id:e.id}}},null,8,["to"]),[[j,"Detail Pesanan",void 0,{bottom:!0}]]),z(t(c,{icon:"pi pi-send",severity:"success",text:"",onClick:s=>pe(e.id)},null,8,["onClick"]),[[j,"Teruskan Pesanan",void 0,{bottom:!0}]]),z(t(c,{icon:"pi pi-times",severity:"danger",text:"",onClick:s=>G(e.id)},null,8,["onClick"]),[[j,"Batalkan",void 0,{bottom:!0}]]),t(i(le),{ref_key:"opCancelConfirm",ref:p,class:"p-0 min-w-[20rem]"},{default:l(()=>[a[22]||(a[22]=o("h6",{class:"mb-2"},"Pembatalan Pesanan",-1)),o("div",kt,[o("div",Tt,[a[21]||(a[21]=o("label",{for:"message"},"Beri alasan",-1)),t(Q,{modelValue:r.reason,"onUpdate:modelValue":a[3]||(a[3]=s=>r.reason=s),id:"message"},null,8,["modelValue"])]),o("div",Ct,[t(c,{label:"Batal",severity:"secondary",text:"",onClick:a[4]||(a[4]=s=>G(s))}),t(c,{label:"Submit",onClick:s=>ue(e.id)},null,8,["onClick"])])])]),_:2},1536)])]),_:1})]),_:1},8,["value","filters","loading"]))]),t(i(ze))],64)}}});export{Qt as default};
