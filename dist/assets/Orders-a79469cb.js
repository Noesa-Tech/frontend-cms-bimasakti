import{s as Ve,a as xe}from"./index-eb552809.js";import{s as we}from"./index-57f17792.js";import{s as ke,a as Te}from"./index-40010c0d.js";import{s as Ce}from"./index-515e86dc.js";import{s as Se}from"./index-9b71a02b.js";import{s as Pe}from"./index-a435d767.js";import{s as Ie,a as De}from"./index-80299c61.js";import{d as Ue,a as b,S as Ae,a9 as $e,r as O,V as K,P as Oe,c as V,f as t,b as o,E as P,J as l,e as s,L as N,z as Ne,o as f,N as g,t as d,H as R,M as Y,F as Re,D as B,W as u,X as c,aa as Be}from"./index-53479ee1.js";import{s as He,a as je}from"./index-85cc6bdd.js";import{s as Me}from"./index-3eba9ed6.js";import{_ as Fe}from"./TopBreadcrumb-d4001bf7.js";import{s as G,a as Q,b as J,c as X}from"./index-3e470de6.js";import{s as Le}from"./index-9ff7f7fc.js";import{s as H}from"./index-4606c741.js";import{s as qe}from"./index-f67a1cdd.js";import{V as We,s as Z}from"./vendor-3f5aca2d.js";import{O as ze}from"./order-0d088d59.js";import"./index-c4ca0144.js";import"./index-48249eea.js";import"./index-0b4e1e4d.js";import"./index-cd33ebaa.js";import"./index-fb056473.js";import"./_plugin-vue_export-helper-c27b6911.js";const Ee={class:"card mt-8"},Ke={class:"flex flex-col md:flex-row justify-between gap-4"},Ye={class:"flex items-center gap-4 md:order-2 order-1"},Ge={class:"hidden md:flex"},Qe={class:"flex md:hidden"},Je={class:"text-start"},Xe={class:"m-0"},Ze={class:"m-0 text-sm text-muted-color"},et={class:"flex flex-col gap-4 w-[25rem]"},tt={class:"flex gap-4 items-center"},at={class:"flex flex-col gap-2"},ot={class:"flex items-center justify-start gap-4"},lt=["src","alt"],nt={class:"flex flex-col items-start text-start gap-4 w-full"},rt={class:"flex flex-col gap-1 w-full"},st={class:"m-0 font-semibold"},it={class:"border rounded-md"},dt={class:"flex items-start justify-between gap-4"},ut={class:"m-0"},ct={class:"m-0"},pt={class:"flex flex-col gap-2 p-2"},mt={class:"flex items-center justify-start gap-2"},ft={class:"flex items-center justify-start gap-2"},vt={class:"m-0"},_t={class:"m-0"},yt={class:"flex items-center gap-2"},gt={key:0},ht={key:1},bt={class:"flex gap-4 items-center"},Vt={class:"flex flex-col gap-4"},xt={class:"flex flex-col gap-2"},wt={class:"flex gap-2 justify-end"},Yt=Ue({__name:"Orders",setup(kt){b({});const j=b(),M=b(),F=Ae(),ee=$e(),L=b(),p=ze(),q=We(),x=b(""),v=O({vendor:null,reason:""}),te=b(0),k=b({global:{value:null,matchMode:u.CONTAINS},noInvoice:{operator:c.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},"user.name":{operator:c.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},"user.email":{operator:c.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},"user.phone":{operator:c.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},"service.name":{operator:c.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},"properties.name":{operator:c.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},location:{operator:c.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},vendor:{operator:c.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},total_fee:{operator:c.AND,constraints:[{value:null,matchMode:u.STARTS_WITH}]},date:{operator:c.AND,constraints:[{value:null,matchMode:u.DATE_IS}]},status:{operator:c.OR,constraints:[{value:null,matchMode:u.EQUALS}]},paymentMethod:{operator:c.OR,constraints:[{value:null,matchMode:u.EQUALS}]}}),ae=O(["order_confirmed","in_process","on_the_way","work_started","waiting_for_payment","completed"]),oe=O(["Transfer Bank","Virtual Account(VA)","GoPay","OVO"]);function I(r){switch(r){case"order_confirmed":return"contrast";case"in_process":return"warn";case"on_the_way":return"info";case"work_started":return"help";case"waiting_for_payment":return"secondary";case"completed":return"success";default:return"default"}}function D(r){switch(r){case"order_confirmed":return"Pesanan Terkonfirmasi";case"in_process":return"Pesanan Diproses";case"on_the_way":return"Menuju Lokasi";case"work_started":return"Sedang Dikerjakan";case"waiting_for_payment":return"Menunggu Pembayaran";case"completed":return"Selesai";default:return"-"}}function le(r){switch(r){case 0:return"Tidak Butuh Tangga";case 1:return"Butuh Tangga";default:return null}}const ne=K(()=>q.vendors.map(r=>({id:r.id,code:r.id,name:r.name,location:r.address,date:r.created_at,status:r.deleted_at,city:r.city,services:r.vendor_service}))),re=K(()=>p.allOrder||[]);Oe(async()=>{var a;const r=localStorage.getItem("AuthStore");if(r){const _=JSON.parse(r);x.value=(a=_==null?void 0:_.users)==null?void 0:a.city_id}await p.fetchOrder("order_confirmed",x.value),await q.fetchVendor()});function se(r){return new Date(r).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"})}const ie=r=>{F.require({target:r.currentTarget,message:"Yakin ingin membatalkan pesanan ini?",icon:"pi pi-info-circle",rejectProps:{label:"Batal",severity:"secondary",outlined:!0},acceptProps:{label:"Yakin",severity:"danger"},accept:async()=>{await p.rejectOrder(v.vendor.id,r,v.reason),await p.fetchOrder("order_confirmed",x.value)},reject:()=>{}})},de=r=>{if(!v.vendor||!v.vendor.name)return ee.add({severity:"error",summary:"Error",detail:"Vendor belum dipilih"});F.require({target:r.currentTarget,message:`Yakin ingin meneruskan pesanan ini kepada vendor '${v.vendor.name}'?`,icon:"pi pi-info-circle",rejectProps:{label:"Batal",severity:"secondary",outlined:!0},acceptProps:{label:"Teruskan",severity:"success"},accept:async()=>{await p.acceptOrder(v.vendor.id,r),await p.fetchOrder("order_confirmed",x.value)},reject:()=>{}})},ue=r=>{j.value.toggle(r)},W=r=>{M.value.toggle(event)},ce=r=>{L.value.exportCSV()};async function pe(r,a,_,i){let U={_method:"PATCH",qty:a.qty,price:a.price,order_service_id:i};await p.updateOrder(U,_),r(),await p.fetchOrder("order_confirmed",x.value)}async function me(r,a,_){let i={_method:"PATCH",fee_properties:a};await p.updateOrder(i,_),r(),await p.fetchOrder("order_confirmed",x.value)}return(r,a)=>{const _=Fe,i=ke,U=He,h=Me,fe=je,m=xe,T=Be,ve=Ie,_e=De,z=Pe,C=Se,E=Ce,ye=Te,A=we,ge=Ve,$=Ne("tooltip");return f(),V(N,null,[t(_,{breadcrumbItems:[{label:"Pesanan"}]}),o("div",Ee,[a[22]||(a[22]=o("div",{class:"font-semibold text-xl mb-4"},"Data Pesanan",-1)),(f(),P(ge,{ref_key:"dt",ref:L,key:te.value,value:s(re),paginator:!0,rows:10,dataKey:"id",filters:k.value,"onUpdate:filters":a[5]||(a[5]=e=>k.value=e),filterDisplay:"menu",loading:s(p).isLoading,globalFilterFields:["noInvoice","user.name","user.email","user.phone","items","location","service.name","properties.name","total_fee","vendor","date","status"],showGridlines:"",scrollable:""},{header:l(()=>[o("div",Ke,[t(i,{type:"button",icon:"pi pi-plus",label:"Tambah Pesanan",class:"md:order-1 order-2",as:"router-link",to:{name:"orders-add"}}),o("div",Ye,[o("div",Ge,[t(i,{type:"button",icon:"pi pi-download",outlined:"",label:"Unduh",onClick:a[0]||(a[0]=e=>ce(e))})]),o("div",Qe,[t(i,{type:"button",icon:"pi pi-download",outlined:""})]),t(fe,{class:"w-full md:w-auto"},{default:l(()=>[t(U,null,{default:l(()=>a[6]||(a[6]=[o("i",{class:"pi pi-search"},null,-1)])),_:1}),t(h,{modelValue:k.value.global.value,"onUpdate:modelValue":a[1]||(a[1]=e=>k.value.global.value=e),placeholder:"Pencarian",fluid:""},null,8,["modelValue"])]),_:1})])])]),empty:l(()=>a[7]||(a[7]=[g(" No order found. ")])),loading:l(()=>a[8]||(a[8]=[g(" Loading order data. Please wait. ")])),default:l(()=>[t(m,{sortable:"",field:"noInvoice",header:"Invoice",class:"min-w-[15rem]"},{body:l(({data:e})=>[g(d(e.invoice),1)]),filter:l(({filterModel:e})=>[t(h,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Invoice"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{sortable:"",field:"user.name",header:"Pelanggan",class:"min-w-[15rem]"},{body:l(({data:e})=>[o("div",Je,[o("h6",Xe,d(e.user.name),1),o("p",Ze,d(e.user.email),1),o("p",{class:"m-0 text-sm text-primary cursor-pointer hover:text-primary-300 transition-all max-w-fit",onClick:ue},[g(d(e.user.phone),1),a[9]||(a[9]=o("i",{class:"pi pi-angle-down ml-2",style:{"font-size":"0.8rem"}},null,-1))]),t(s(Z),{ref_key:"opPhone",ref:j},{default:l(()=>[o("div",et,[o("div",null,[a[10]||(a[10]=o("h6",{class:"mb-0"},"Opsi Nomor Telepon",-1)),t(T)]),t(_e,null,{default:l(()=>[t(h,{value:e.user.phone,readonly:"",class:"w-[25rem]"},null,8,["value"]),t(ve,null,{default:l(()=>[t(i,{icon:"pi pi-phone"})]),_:1})]),_:2},1024),o("div",tt,[t(T),a[11]||(a[11]=o("p",{class:"m-0 text-center text-muted-color text-sm"},"Atau",-1)),t(T)]),o("div",at,[a[12]||(a[12]=o("label",{for:"message"},"Kirim Pesan",-1)),t(z,{id:"message"})]),t(i,{icon:"pi pi-send",label:"Kirim Pesan",iconPos:"right"})])]),_:2},1536)])]),filter:l(({filterModel:e})=>[t(h,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Pelanggan"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{sortable:"",header:"Lokasi",filterField:"location",class:"min-w-[24rem]"},{body:l(({data:e})=>[g(d(e.location),1)]),filter:l(({filterModel:e})=>[t(h,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Kota"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{sortable:"",header:"Layanan",filterField:"service.name",class:"min-w-[40rem]"},{body:l(({data:e})=>[t(s(G),{value:"0"},{default:l(()=>[t(s(Q),{value:"1",class:"accordion-table"},{default:l(()=>[t(s(J),null,{default:l(()=>[o("div",ot,[e.service.full_image_url?(f(),V("img",{key:0,src:e.service.full_image_url,alt:e.service.name,class:"h-6 text-sm font-normal"},null,8,lt)):R("",!0),o("span",null,d(e.service.name),1)])]),_:2},1024),t(s(X),null,{default:l(()=>[t(T),t(s(G),{value:"0"},{default:l(()=>[(f(!0),V(N,null,Y(e.problems,(n,w)=>(f(),P(s(Q),{key:n.name,value:w},{default:l(()=>[t(s(J),{class:Re({"accordion-subheader":e.service.image_url})},{default:l(()=>[g(d(n.name),1)]),_:2},1032,["class"]),t(s(X),{class:"accordion-content"},{default:l(()=>[o("div",nt,[(f(!0),V(N,null,Y(n.sub_problem,(y,he)=>(f(),V("div",{key:he,class:"w-full"},[o("div",rt,[o("p",st,"â€¢ Kategori: "+d(y.name),1),o("div",it,[t(E,{class:"inplace-display-full"},{display:l(()=>[o("div",dt,[o("div",null,[o("p",ut,"QTY: "+d(y.qty),1),o("p",ct,"Harga: Rp"+d(r.formatPrice(y.price)),1)]),a[13]||(a[13]=o("i",{class:"pi pi-pencil ml-2"},null,-1))])]),content:l(({closeCallback:be})=>[o("div",pt,[o("div",mt,[a[16]||(a[16]=o("p",{class:"m-0"},"QTY: ",-1)),t(C,{modelValue:y.qty,"onUpdate:modelValue":S=>y.qty=S,inputId:"horizontal-buttons",showButtons:"",buttonLayout:"horizontal",min:0,max:99,inputClass:" text-center border-l border-l-red-500 border-r border-r-green-500 bg-transparent max-w-[4rem]",incrementButtonClass:"border-green-500",decrementButtonClass:"border-red-500",small:""},{incrementbuttonicon:l(()=>a[14]||(a[14]=[o("span",{class:"pi pi-plus"},null,-1)])),decrementbuttonicon:l(()=>a[15]||(a[15]=[o("span",{class:"pi pi-minus"},null,-1)])),_:2},1032,["modelValue","onUpdate:modelValue"])]),o("div",ft,[a[17]||(a[17]=o("p",{class:"m-0"},"Harga: ",-1)),t(C,{modelValue:y.price,"onUpdate:modelValue":S=>y.price=S,type:"text",placeholder:"Masukkan Harga",inputId:"currency-indonesia",mode:"currency",currency:"IDR",locale:"id-ID",minFractionDigits:0},null,8,["modelValue","onUpdate:modelValue"])]),t(i,{label:"Simpan",icon:"pi pi-check",outlined:"",severity:"success",class:"max-w-fit",onClick:S=>pe(be,y,e.id,y.id)},null,8,["onClick"])])]),_:2},1024)])])]))),128))])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),t(m,{field:"properties.name",header:"Jenis Property",class:"min-w-[15rem]",sortable:""},{body:l(({data:e})=>[o("div",null,[o("p",vt,d(e.properties.name),1),e.isLadderRequired?(f(),P(ye,{key:0,value:le(e.isLadderRequired)??"",size:"small",class:"mb-2"},null,8,["value"])):R("",!0),t(E,{class:"inplace-custom-display"},{display:l(()=>[o("p",_t,[g("Rp"+d(r.formatPrice(e.fee_properties)),1),a[18]||(a[18]=o("i",{class:"pi pi-pencil ml-2"},null,-1))])]),content:l(({closeCallback:n})=>[o("div",yt,[t(C,{modelValue:e.fee_properties,"onUpdate:modelValue":w=>e.fee_properties=w,type:"text",placeholder:"Cari Harga",inputId:"currency-indonesia",mode:"currency",currency:"IDR",locale:"id-ID",minFractionDigits:0},null,8,["modelValue","onUpdate:modelValue"]),t(i,{icon:"pi pi-check",outlined:"",severity:"success",onClick:w=>me(n,e.fee_properties,e.id)},null,8,["onClick"])])]),_:2},1024)])]),filter:l(({filterModel:e})=>[t(h,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Property"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{sortable:"",field:"total_fee",header:"Total Harga",class:"min-w-[15rem]"},{body:l(({data:e})=>[e.total_fee?(f(),V("span",gt,"Rp"+d(r.formatPrice(e.total_fee)),1)):(f(),V("span",ht,"Harga belum ditentukan"))]),filter:l(({filterModel:e})=>[t(C,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Harga",inputId:"currency-indonesia",mode:"currency",currency:"IDR",locale:"id-ID",minFractionDigits:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{sortable:"",header:"Status",field:"status",filterMenuStyle:{width:"18rem"},class:"min-w-[20rem]"},{body:l(({data:e})=>[t(A,{value:D(e.status),severity:I(e.status),class:"whitespace-nowrap"},null,8,["value","severity"])]),filter:l(({filterModel:e})=>[t(s(H),{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,options:ae,placeholder:"Pilih",showClear:""},{value:l(n=>[n.value!=null?(f(),P(A,{key:0,value:D(n.value),severity:I(n.value)},null,8,["value","severity"])):R("",!0)]),option:l(n=>[t(A,{value:D(n.option),severity:I(n.option)},null,8,["value","severity"])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),t(m,{sortable:"",field:"paymentMethod",header:"Metode Pembayaran",class:"min-w-[15rem]"},{body:l(({data:e})=>a[19]||(a[19]=[g(" Bank Transfer ")])),filter:l(({filterModel:e})=>[t(s(H),{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,options:oe,placeholder:"Pilih",showClear:""},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),t(m,{sortable:"",field:"vendor",header:"Vendor Pilihan",class:"min-w-[15rem]"},{body:l(({data:e})=>{var n;return[t(s(H),{modelValue:v.vendor,"onUpdate:modelValue":a[2]||(a[2]=w=>v.vendor=w),options:s(ne),value:(n=e==null?void 0:e.vendor_id)==null?void 0:n.name,filter:"",optionLabel:"name",placeholder:"Pilih Vendor",class:"w-[15rem]"},null,8,["modelValue","options","value"])]}),filter:l(({filterModel:e})=>[t(h,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Vendor"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{sortable:"",header:"Tanggal Pesanan",filterField:"date",dataType:"date",class:"min-w-[20rem]"},{body:l(({data:e})=>[g(d(se(e.created_at)),1)]),filter:l(({filterModel:e})=>[t(s(Le),{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{sortable:"",field:"id",header:"Action",bodyClass:"text-center",class:"min-w-[10rem]"},{body:l(({data:e})=>[o("div",bt,[B(t(i,{icon:"pi pi-external-link",severity:"info",text:"",as:"router-link",to:{name:"order-detail",params:{id:e.id}}},null,8,["to"]),[[$,"Detail Pesanan",void 0,{bottom:!0}]]),B(t(i,{icon:"pi pi-send",severity:"success",text:"",onClick:n=>de(e.id)},null,8,["onClick"]),[[$,"Teruskan Pesanan",void 0,{bottom:!0}]]),B(t(i,{icon:"pi pi-times",severity:"danger",text:"",onClick:n=>W(e.id)},null,8,["onClick"]),[[$,"Batalkan",void 0,{bottom:!0}]]),t(s(Z),{ref_key:"opCancelConfirm",ref:M,class:"p-0 min-w-[20rem]"},{default:l(()=>[a[21]||(a[21]=o("h6",{class:"mb-2"},"Pembatalan Pesanan",-1)),o("div",Vt,[o("div",xt,[a[20]||(a[20]=o("label",{for:"message"},"Beri alasan",-1)),t(z,{modelValue:v.reason,"onUpdate:modelValue":a[3]||(a[3]=n=>v.reason=n),id:"message"},null,8,["modelValue"])]),o("div",wt,[t(i,{label:"Batal",severity:"secondary",text:"",onClick:a[4]||(a[4]=n=>W(n))}),t(i,{label:"Submit",onClick:n=>ie(e.id)},null,8,["onClick"])])])]),_:2},1536)])]),_:1})]),_:1},8,["value","filters","loading"]))]),t(s(qe))],64)}}});export{Yt as default};
