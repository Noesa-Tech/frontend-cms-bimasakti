import{s as Te,a as Se}from"./index-68f446c4.js";import{s as Ce}from"./index-8ac98554.js";import{s as Pe,a as Ie}from"./index-90b3f33a.js";import{s as Ue}from"./index-c9f01e59.js";import{s as De}from"./index-20c9f818.js";import{s as Ae}from"./index-4681673b.js";import{s as $e,a as Oe}from"./index-f308c7e7.js";import{d as Ne,a as V,S as He,a9 as Re,r as N,V as X,P as Be,c as h,f as t,b as o,E as U,J as l,e as r,L as D,z as je,o as p,N as b,t as u,H,M as R,F as Me,D as B,W as m,X as v,aa as Fe}from"./index-adf5aec1.js";import{s as Le,a as qe}from"./index-48379622.js";import{s as We}from"./index-b285b457.js";import{_ as ze}from"./TopBreadcrumb-da2a10f0.js";import{s as Z,a as ee,b as te,c as ae}from"./index-bb4f9bcf.js";import{s as Ee}from"./index-027af45e.js";import{s as j}from"./index-a5b58834.js";import{s as Ke}from"./index-ec06ee30.js";import{s as M}from"./index-8dd853d4.js";import{O as Ye}from"./order-cbd730ef.js";import{V as Ge}from"./vendor-2b08aafc.js";import"./index-6cc98fa5.js";import"./index-cb228e74.js";import"./index-493dece7.js";import"./index-5d981455.js";import"./index-67deca27.js";import"./_plugin-vue_export-helper-c27b6911.js";const Qe={class:"card mt-8"},Je={class:"flex flex-col md:flex-row justify-between gap-4"},Xe={class:"flex items-center gap-4 md:order-2 order-1"},Ze={class:"hidden md:flex"},et={class:"flex md:hidden"},tt={class:"text-start"},at={class:"m-0"},ot={class:"m-0 text-sm text-muted-color"},lt={class:"flex flex-col gap-4 w-[25rem]"},st={class:"flex gap-4 items-center"},nt={class:"flex flex-col gap-2"},rt={class:"flex items-center justify-start gap-4"},it=["src","alt"],dt={class:"flex flex-col items-start text-start gap-4 w-full"},ut={class:"flex flex-col gap-1 w-full"},ct={class:"m-0 font-semibold"},pt={class:"border rounded-md"},mt={class:"flex items-start justify-between gap-4"},ft={class:"m-0"},vt={class:"m-0"},_t={class:"flex flex-col gap-2 p-2"},yt={class:"flex items-center justify-start gap-2"},gt={class:"flex items-center justify-start gap-2"},ht={class:"m-0"},bt={class:"m-0"},Vt={class:"flex items-center gap-2"},xt={key:0},wt={key:1},kt={class:"flex flex-col gap-4"},Tt={class:"list-none p-0 m-0 flex flex-col"},St={class:"flex gap-4 items-center"},Ct={class:"flex flex-col gap-4"},Pt={class:"flex flex-col gap-2"},It={class:"flex gap-2 justify-end"},ta=Ne({__name:"Orders",setup(Ut){const A=V(),F=V(),L=V(),q=He(),oe=Re(),W=V(),c=Ye(),z=Ge(),x=V(""),E=V(null),g=N({vendor:[],reason:""}),le=V(0),k=V({global:{value:null,matchMode:m.CONTAINS},noInvoice:{operator:v.AND,constraints:[{value:null,matchMode:m.STARTS_WITH}]},"user.name":{operator:v.AND,constraints:[{value:null,matchMode:m.STARTS_WITH}]},"user.email":{operator:v.AND,constraints:[{value:null,matchMode:m.STARTS_WITH}]},"user.phone":{operator:v.AND,constraints:[{value:null,matchMode:m.STARTS_WITH}]},"service.name":{operator:v.AND,constraints:[{value:null,matchMode:m.STARTS_WITH}]},"properties.name":{operator:v.AND,constraints:[{value:null,matchMode:m.STARTS_WITH}]},location:{operator:v.AND,constraints:[{value:null,matchMode:m.STARTS_WITH}]},vendor:{operator:v.AND,constraints:[{value:null,matchMode:m.STARTS_WITH}]},total_fee:{operator:v.AND,constraints:[{value:null,matchMode:m.STARTS_WITH}]},date:{operator:v.AND,constraints:[{value:null,matchMode:m.DATE_IS}]},status:{operator:v.OR,constraints:[{value:null,matchMode:m.EQUALS}]},paymentMethod:{operator:v.OR,constraints:[{value:null,matchMode:m.EQUALS}]}}),K=N(["order_confirmed","in_process","on_the_way","work_started","waiting_for_payment","completed"]),se=N(["Transfer Bank","Virtual Account(VA)","GoPay","OVO"]);function T(s){switch(s){case"order_confirmed":return"contrast";case"in_process":return"warn";case"on_the_way":return"info";case"work_started":return"help";case"waiting_for_payment":return"secondary";case"completed":return"success";default:return"default"}}function S(s){switch(s){case"order_confirmed":return"Pesanan Terkonfirmasi";case"in_process":return"Pesanan Diproses";case"on_the_way":return"Menuju Lokasi";case"work_started":return"Sedang Dikerjakan";case"waiting_for_payment":return"Menunggu Pembayaran";case"completed":return"Selesai";default:return"-"}}function ne(s){switch(s){case 0:return"Tidak Butuh Tangga";case 1:return"Butuh Tangga";default:return null}}const re=X(()=>z.vendors.map(s=>({id:s.id,code:s.id,name:s.name,location:s.address,date:s.created_at,status:s.deleted_at,city:s.city,services:s.vendor_service}))),ie=X(()=>c.allOrder||[]);Be(async()=>{var a;const s=localStorage.getItem("AuthStore");if(s){const _=JSON.parse(s);x.value=(a=_==null?void 0:_.users)==null?void 0:a.city_id}await c.fetchOrder("order_confirmed",x.value),await z.fetchVendor()});function de(s){return new Date(s).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"})}const ue=s=>{q.require({target:s.currentTarget,message:"Yakin ingin membatalkan pesanan ini?",icon:"pi pi-info-circle",rejectProps:{label:"Batal",severity:"secondary",outlined:!0},acceptProps:{label:"Yakin",severity:"danger"},accept:async()=>{await c.rejectOrder(g.vendor[E.value].id,s,g.reason),await c.fetchOrder("order_confirmed",x.value)},reject:()=>{}})},ce=(s,a)=>{if(!g.vendor)return oe.add({severity:"error",summary:"Error",detail:"Vendor belum dipilih"});q.require({target:s.currentTarget,message:`Yakin ingin meneruskan pesanan ini kepada vendor '${g.vendor[a].name}'?`,icon:"pi pi-info-circle",rejectProps:{label:"Batal",severity:"secondary",outlined:!0},acceptProps:{label:"Teruskan",severity:"success"},accept:async()=>{await c.acceptOrder(g.vendor[a].id,s),await c.fetchOrder("order_confirmed",x.value)},reject:()=>{}})},pe=s=>{F.value.toggle(s)},Y=s=>{L.value.toggle(event)},me=s=>{W.value.exportCSV()};async function fe(s,a,_,i){let $={_method:"PATCH",qty:a.qty,price:a.price,order_service_id:i};await c.updateOrder($,_),s(),await c.fetchOrder("order_confirmed",x.value)}async function ve(s,a,_){let i={_method:"PATCH",fee_properties:a};await c.updateOrder(i,_),s(),await c.fetchOrder("order_confirmed",x.value)}const _e=s=>{A.value.toggle(s)};async function ye(s,a){let _={_method:"PATCH",status:s};await c.updateOrder(_,a),A.value.hide(),await c.fetchOrder("order_confirmed",x.value)}return(s,a)=>{const _=ze,i=Pe,$=Le,w=We,ge=qe,y=Se,C=Fe,he=$e,be=Oe,G=Ae,P=De,Q=Ue,Ve=Ie,J=Ce,xe=Te,O=je("tooltip");return p(),h(D,null,[t(_,{breadcrumbItems:[{label:"Pesanan"}]}),o("div",Qe,[a[22]||(a[22]=o("div",{class:"font-semibold text-xl mb-4"},"Data Pesanan",-1)),(p(),U(xe,{ref_key:"dt",ref:W,key:le.value,value:r(ie),paginator:!0,rows:10,dataKey:"id",filters:k.value,"onUpdate:filters":a[4]||(a[4]=e=>k.value=e),filterDisplay:"menu",loading:r(c).isLoading,globalFilterFields:["noInvoice","user.name","user.email","user.phone","items","location","service.name","properties.name","total_fee","vendor","date","status"],showGridlines:"",scrollable:""},{header:l(()=>[o("div",Je,[t(i,{type:"button",icon:"pi pi-plus",label:"Tambah Pesanan",class:"md:order-1 order-2",as:"router-link",to:{name:"orders-add"}}),o("div",Xe,[o("div",Ze,[t(i,{type:"button",icon:"pi pi-download",outlined:"",label:"Unduh",onClick:a[0]||(a[0]=e=>me(e))})]),o("div",et,[t(i,{type:"button",icon:"pi pi-download",outlined:""})]),t(ge,{class:"w-full md:w-auto"},{default:l(()=>[t($,null,{default:l(()=>a[5]||(a[5]=[o("i",{class:"pi pi-search"},null,-1)])),_:1}),t(w,{modelValue:k.value.global.value,"onUpdate:modelValue":a[1]||(a[1]=e=>k.value.global.value=e),placeholder:"Pencarian",fluid:""},null,8,["modelValue"])]),_:1})])])]),empty:l(()=>a[6]||(a[6]=[b(" No order found. ")])),loading:l(()=>a[7]||(a[7]=[b(" Loading order data. Please wait. ")])),default:l(()=>[t(y,{sortable:"",field:"noInvoice",header:"Invoice",class:"min-w-[15rem]"},{body:l(({data:e})=>[b(u(e.invoice),1)]),filter:l(({filterModel:e})=>[t(w,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Invoice"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(y,{sortable:"",field:"user.name",header:"Pelanggan",class:"min-w-[15rem]"},{body:l(({data:e})=>[o("div",tt,[o("h6",at,u(e.user.name),1),o("p",ot,u(e.user.email),1),o("p",{class:"m-0 text-sm text-primary cursor-pointer hover:text-primary-300 transition-all max-w-fit",onClick:pe},[b(u(e.user.phone),1),a[8]||(a[8]=o("i",{class:"pi pi-angle-down ml-2",style:{"font-size":"0.8rem"}},null,-1))]),t(r(M),{ref_key:"opPhone",ref:F},{default:l(()=>[o("div",lt,[o("div",null,[a[9]||(a[9]=o("h6",{class:"mb-0"},"Opsi Nomor Telepon",-1)),t(C)]),t(be,null,{default:l(()=>[t(w,{value:e.user.phone,readonly:"",class:"w-[25rem]"},null,8,["value"]),t(he,null,{default:l(()=>[t(i,{icon:"pi pi-phone"})]),_:1})]),_:2},1024),o("div",st,[t(C),a[10]||(a[10]=o("p",{class:"m-0 text-center text-muted-color text-sm"},"Atau",-1)),t(C)]),o("div",nt,[a[11]||(a[11]=o("label",{for:"message"},"Kirim Pesan",-1)),t(G,{id:"message"})]),t(i,{icon:"pi pi-send",label:"Kirim Pesan",iconPos:"right"})])]),_:2},1536)])]),filter:l(({filterModel:e})=>[t(w,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Pelanggan"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(y,{sortable:"",header:"Lokasi",filterField:"location",class:"min-w-[24rem]"},{body:l(({data:e})=>[b(u(e.location),1)]),filter:l(({filterModel:e})=>[t(w,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Kota"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(y,{sortable:"",header:"Layanan",filterField:"service.name",class:"min-w-[40rem]"},{body:l(({data:e})=>[t(r(Z),{value:"0"},{default:l(()=>[t(r(ee),{value:"1",class:"accordion-table"},{default:l(()=>[t(r(te),null,{default:l(()=>[o("div",rt,[e.service.full_image_url?(p(),h("img",{key:0,src:e.service.full_image_url,alt:e.service.name,class:"h-6 text-sm font-normal"},null,8,it)):H("",!0),o("span",null,u(e.service.name),1)])]),_:2},1024),t(r(ae),null,{default:l(()=>[t(C),t(r(Z),{value:"0"},{default:l(()=>[(p(!0),h(D,null,R(e.problems,(n,d)=>(p(),U(r(ee),{key:n.name,value:d},{default:l(()=>[t(r(te),{class:Me({"accordion-subheader":e.service.image_url})},{default:l(()=>[b(u(n.name),1)]),_:2},1032,["class"]),t(r(ae),{class:"accordion-content"},{default:l(()=>[o("div",dt,[(p(!0),h(D,null,R(n.sub_problem,(f,we)=>(p(),h("div",{key:we,class:"w-full"},[o("div",ut,[o("p",ct,"• Kategori: "+u(f.name),1),o("div",pt,[t(Q,{class:"inplace-display-full"},{display:l(()=>[o("div",mt,[o("div",null,[o("p",ft,"QTY: "+u(f.qty),1),o("p",vt,"Harga: Rp"+u(s.formatPrice(f.price)),1)]),a[12]||(a[12]=o("i",{class:"pi pi-pencil ml-2"},null,-1))])]),content:l(({closeCallback:ke})=>[o("div",_t,[o("div",yt,[a[15]||(a[15]=o("p",{class:"m-0"},"QTY: ",-1)),t(P,{modelValue:f.qty,"onUpdate:modelValue":I=>f.qty=I,inputId:"horizontal-buttons",showButtons:"",buttonLayout:"horizontal",min:0,max:99,inputClass:" text-center border-l border-l-red-500 border-r border-r-green-500 bg-transparent max-w-[4rem]",incrementButtonClass:"border-green-500",decrementButtonClass:"border-red-500",small:""},{incrementbuttonicon:l(()=>a[13]||(a[13]=[o("span",{class:"pi pi-plus"},null,-1)])),decrementbuttonicon:l(()=>a[14]||(a[14]=[o("span",{class:"pi pi-minus"},null,-1)])),_:2},1032,["modelValue","onUpdate:modelValue"])]),o("div",gt,[a[16]||(a[16]=o("p",{class:"m-0"},"Harga: ",-1)),t(P,{modelValue:f.price,"onUpdate:modelValue":I=>f.price=I,type:"text",placeholder:"Masukkan Harga",inputId:"currency-indonesia",mode:"currency",currency:"IDR",locale:"id-ID",minFractionDigits:0},null,8,["modelValue","onUpdate:modelValue"])]),t(i,{label:"Simpan",icon:"pi pi-check",outlined:"",severity:"success",class:"max-w-fit",onClick:I=>fe(ke,f,e.id,f.id)},null,8,["onClick"])])]),_:2},1024)])])]))),128))])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),t(y,{field:"properties.name",header:"Jenis Property",class:"min-w-[15rem]",sortable:""},{body:l(({data:e})=>[o("div",null,[o("p",ht,u(e.properties.name),1),e.isLadderRequired?(p(),U(Ve,{key:0,value:ne(e.isLadderRequired)??"",size:"small",class:"mb-2"},null,8,["value"])):H("",!0),t(Q,{class:"inplace-custom-display"},{display:l(()=>[o("p",bt,[b("Rp"+u(s.formatPrice(e.fee_properties)),1),a[17]||(a[17]=o("i",{class:"pi pi-pencil ml-2"},null,-1))])]),content:l(({closeCallback:n})=>[o("div",Vt,[t(P,{modelValue:e.fee_properties,"onUpdate:modelValue":d=>e.fee_properties=d,type:"text",placeholder:"Cari Harga",inputId:"currency-indonesia",mode:"currency",currency:"IDR",locale:"id-ID",minFractionDigits:0},null,8,["modelValue","onUpdate:modelValue"]),t(i,{icon:"pi pi-check",outlined:"",severity:"success",onClick:d=>ve(n,e.fee_properties,e.id)},null,8,["onClick"])])]),_:2},1024)])]),filter:l(({filterModel:e})=>[t(w,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Property"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(y,{sortable:"",field:"total_fee",header:"Total Harga",class:"min-w-[15rem]"},{body:l(({data:e})=>[e.total_fee?(p(),h("span",xt,"Rp"+u(s.formatPrice(e.total_fee)),1)):(p(),h("span",wt,"Harga belum ditentukan"))]),filter:l(({filterModel:e})=>[t(P,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Harga",inputId:"currency-indonesia",mode:"currency",currency:"IDR",locale:"id-ID",minFractionDigits:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(y,{sortable:"",header:"Status",field:"status",filterMenuStyle:{width:"18rem"},class:"min-w-[20rem]"},{body:l(({data:e})=>[t(i,{label:S(e.status),severity:T(e.status),onClick:_e,size:"small",icon:"pi pi-chevron-down",iconPos:"right"},null,8,["label","severity"]),t(r(M),{ref_key:"opStatus",ref:A},{default:l(()=>[o("div",kt,[o("div",null,[a[18]||(a[18]=o("span",{class:"font-medium block mb-2"},"Ubah Status",-1)),o("ul",Tt,[(p(!0),h(D,null,R(K,(n,d)=>(p(),h("li",{key:d,class:"flex items-center gap-2 px-2 py-3"},[t(i,{label:S(n),severity:T(n),size:"small",onClick:f=>ye(n,e.id)},null,8,["label","severity","onClick"])]))),128))])])])]),_:2},1536)]),filter:l(({filterModel:e})=>[t(r(j),{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,options:K,placeholder:"Pilih",showClear:""},{value:l(n=>[n.value!=null?(p(),U(J,{key:0,value:S(n.value),severity:T(n.value)},null,8,["value","severity"])):H("",!0)]),option:l(n=>[t(J,{value:S(n.option),severity:T(n.option)},null,8,["value","severity"])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),t(y,{sortable:"",field:"paymentMethod",header:"Metode Pembayaran",class:"min-w-[15rem]"},{body:l(({data:e})=>a[19]||(a[19]=[b(" Bank Transfer ")])),filter:l(({filterModel:e})=>[t(r(j),{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,options:se,placeholder:"Pilih",showClear:""},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),t(y,{sortable:"",field:"vendor",header:"Vendor Pilihan",class:"min-w-[15rem]"},{body:l(({data:e,index:n})=>{var d;return[t(r(j),{modelValue:g.vendor[n],"onUpdate:modelValue":f=>g.vendor[n]=f,options:r(re),value:(d=e==null?void 0:e.vendor_id)==null?void 0:d.name,filter:"",optionLabel:"name",placeholder:"Pilih Vendor",class:"w-[15rem]"},null,8,["modelValue","onUpdate:modelValue","options","value"])]}),filter:l(({filterModel:e})=>[t(w,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Vendor"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(y,{sortable:"",header:"Tanggal Pesanan",filterField:"date",dataType:"date",class:"min-w-[20rem]"},{body:l(({data:e})=>[b(u(de(e.created_at)),1)]),filter:l(({filterModel:e})=>[t(r(Ee),{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(y,{sortable:"",field:"id",header:"Action",bodyClass:"text-center",class:"min-w-[10rem]"},{body:l(({data:e,index:n})=>[o("div",St,[B(t(i,{icon:"pi pi-external-link",severity:"info",text:"",as:"router-link",to:{name:"order-detail",params:{id:e.id}}},null,8,["to"]),[[O,"Detail Pesanan",void 0,{bottom:!0}]]),B(t(i,{icon:"pi pi-send",severity:"success",text:"",onClick:d=>ce(e.id,n)},null,8,["onClick"]),[[O,"Teruskan Pesanan",void 0,{bottom:!0}]]),B(t(i,{icon:"pi pi-times",severity:"danger",text:"",onClick:d=>(Y(e.id),E.value=n)},null,8,["onClick"]),[[O,"Batalkan",void 0,{bottom:!0}]]),t(r(M),{ref_key:"opCancelConfirm",ref:L,class:"p-0 min-w-[20rem]"},{default:l(()=>[a[21]||(a[21]=o("h6",{class:"mb-2"},"Pembatalan Pesanan",-1)),o("div",Ct,[o("div",Pt,[a[20]||(a[20]=o("label",{for:"message"},"Beri alasan",-1)),t(G,{modelValue:g.reason,"onUpdate:modelValue":a[2]||(a[2]=d=>g.reason=d),id:"message"},null,8,["modelValue"])]),o("div",It,[t(i,{label:"Batal",severity:"secondary",text:"",onClick:a[3]||(a[3]=d=>Y(d))}),t(i,{label:"Submit",onClick:d=>ue(e.id)},null,8,["onClick"])])])]),_:2},1536)])]),_:1})]),_:1},8,["value","filters","loading"]))]),t(r(Ke))],64)}}});export{ta as default};
