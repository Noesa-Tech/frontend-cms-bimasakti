import{s as be,a as he}from"./index-adc43363.js";import{s as Ve}from"./index-cc3a5053.js";import{s as xe,a as we}from"./index-054cffa9.js";import{s as ke}from"./index-2a809236.js";import{s as Te}from"./index-8d5d91a7.js";import{s as Ce}from"./index-727622eb.js";import{s as Se,a as Ie}from"./index-9e15c7a6.js";import{d as De,a as h,S as Pe,a9 as Ue,r as U,V as E,P as Ae,c as g,f as t,b as a,E as T,J as l,e as r,L as A,z as $e,o as p,N as v,t as i,H as $,M as K,F as Ne,D as N,W as d,X as c,aa as Re}from"./index-6fd353ed.js";import{s as Be,a as Oe}from"./index-010bf46f.js";import{s as He}from"./index-373cac24.js";import{_ as je}from"./TopBreadcrumb-5bc9eed2.js";import{s as Y,a as G,b as Q,c as J}from"./index-7feb40e6.js";import{s as Me}from"./index-12387b00.js";import{s as R}from"./index-a48de1cd.js";import{s as Fe}from"./index-2ebf4360.js";import{V as Le,s as X}from"./vendor-84129101.js";import{O as We}from"./order-95db7010.js";import"./index-662d48a9.js";import"./index-d0d06c16.js";import"./index-077105b5.js";import"./index-d62b0b1b.js";import"./index-e60aa67a.js";import"./_plugin-vue_export-helper-c27b6911.js";const qe={class:"card mt-8"},ze={class:"flex flex-col md:flex-row justify-between gap-4"},Ee={class:"flex items-center gap-4 md:order-2 order-1"},Ke={class:"hidden md:flex"},Ye={class:"flex md:hidden"},Ge={class:"text-start"},Qe={class:"m-0"},Je={class:"m-0 text-sm text-muted-color"},Xe={class:"flex flex-col gap-4 w-[25rem]"},Ze={class:"flex gap-4 items-center"},et={class:"flex flex-col gap-2"},tt={class:"flex items-center justify-start gap-4"},at=["src","alt"],ot={class:"flex flex-col items-start text-start gap-4 w-full"},lt={class:"flex flex-col gap-1 w-full"},nt={class:"m-0 font-semibold"},st={class:"border rounded-md"},rt={class:"flex items-start justify-between gap-4"},it={class:"m-0"},dt={class:"m-0"},ut={class:"flex flex-col gap-2 p-2"},ct={class:"flex items-center justify-start gap-2"},mt={class:"flex items-center justify-start gap-2"},pt={class:"m-0"},ft={class:"m-0"},vt={class:"flex items-center gap-2"},_t={key:0},yt={key:1},gt={class:"flex gap-4 items-center"},bt={class:"flex flex-col gap-4"},ht={class:"flex flex-col gap-2"},Vt={class:"flex gap-2 justify-end"},Et=De({__name:"Orders",setup(xt){h({});const B=h(),O=h(),H=Pe(),Z=Ue(),j=h(),b=We(),M=Le(),f=U({vendor:null,reason:""}),F=h(0),x=h({global:{value:null,matchMode:d.CONTAINS},noInvoice:{operator:c.AND,constraints:[{value:null,matchMode:d.STARTS_WITH}]},"user.name":{operator:c.AND,constraints:[{value:null,matchMode:d.STARTS_WITH}]},"user.email":{operator:c.AND,constraints:[{value:null,matchMode:d.STARTS_WITH}]},"user.phone":{operator:c.AND,constraints:[{value:null,matchMode:d.STARTS_WITH}]},"service.name":{operator:c.AND,constraints:[{value:null,matchMode:d.STARTS_WITH}]},"properties.name":{operator:c.AND,constraints:[{value:null,matchMode:d.STARTS_WITH}]},location:{operator:c.AND,constraints:[{value:null,matchMode:d.STARTS_WITH}]},vendor:{operator:c.AND,constraints:[{value:null,matchMode:d.STARTS_WITH}]},total_fee:{operator:c.AND,constraints:[{value:null,matchMode:d.STARTS_WITH}]},date:{operator:c.AND,constraints:[{value:null,matchMode:d.DATE_IS}]},status:{operator:c.OR,constraints:[{value:null,matchMode:d.EQUALS}]},paymentMethod:{operator:c.OR,constraints:[{value:null,matchMode:d.EQUALS}]}}),ee=U(["order_confirmed","in_process","on_the_way","work_started","waiting_for_payment","completed"]),te=U(["Transfer Bank","Virtual Account(VA)","GoPay","OVO"]);function C(s){switch(s){case"order_confirmed":return"contrast";case"in_process":return"warn";case"on_the_way":return"info";case"work_started":return"help";case"waiting_for_payment":return"secondary";case"completed":return"success";default:return"default"}}function S(s){switch(s){case"order_confirmed":return"Pesanan Terkonfirmasi";case"in_process":return"Pesanan Diproses";case"on_the_way":return"Menuju Lokasi";case"work_started":return"Sedang Dikerjakan";case"waiting_for_payment":return"Menunggu Pembayaran";case"completed":return"Selesai";default:return"-"}}function ae(s){switch(s){case 0:return"Tidak Butuh Tangga";case 1:return"Butuh Tangga";default:return null}}const oe=E(()=>M.vendors.map(s=>({id:s.id,code:s.id,name:s.name,location:s.address,date:s.created_at,status:s.deleted_at,city:s.city,services:s.vendor_service}))),le=E(()=>b.allOrder||[]);async function L(){await b.fetchOrder(),F.value+=1}Ae(async()=>{await b.fetchOrder("order_confirmed"),await M.fetchVendor()});function ne(s){return new Date(s).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"})}const se=s=>{H.require({target:s.currentTarget,message:"Yakin ingin membatalkan pesanan ini?",icon:"pi pi-info-circle",rejectProps:{label:"Batal",severity:"secondary",outlined:!0},acceptProps:{label:"Yakin",severity:"danger"},accept:async()=>{await b.rejectOrder(f.vendor.id,s,f.reason),await L()},reject:()=>{}})},re=s=>{if(!f.vendor||!f.vendor.name)return Z.add({severity:"error",summary:"Error",detail:"Vendor belum dipilih"});H.require({target:s.currentTarget,message:`Yakin ingin meneruskan pesanan ini kepada vendor '${f.vendor.name}'?`,icon:"pi pi-info-circle",rejectProps:{label:"Batal",severity:"secondary",outlined:!0},acceptProps:{label:"Teruskan",severity:"success"},accept:async()=>{await b.acceptOrder(f.vendor.id,s),await L()},reject:()=>{}})},ie=s=>{B.value.toggle(s)},W=s=>{O.value.toggle(event)},de=s=>{j.value.exportCSV()};return(s,o)=>{const ue=je,u=xe,ce=Be,_=He,me=Oe,m=he,w=Re,pe=Se,fe=Ie,q=Ce,k=Te,z=ke,ve=we,I=Ve,_e=be,D=$e("tooltip");return p(),g(A,null,[t(ue,{breadcrumbItems:[{label:"Pesanan"}]}),a("div",qe,[o[22]||(o[22]=a("div",{class:"font-semibold text-xl mb-4"},"Data Pesanan",-1)),(p(),T(_e,{ref_key:"dt",ref:j,key:F.value,value:r(le),paginator:!0,rows:10,dataKey:"id",filters:x.value,"onUpdate:filters":o[5]||(o[5]=e=>x.value=e),filterDisplay:"menu",loading:r(b).isLoading,globalFilterFields:["noInvoice","user.name","user.email","user.phone","items","location","service.name","properties.name","total_fee","vendor","date","status"],showGridlines:"",scrollable:""},{header:l(()=>[a("div",ze,[t(u,{type:"button",icon:"pi pi-plus",label:"Tambah Pesanan",class:"md:order-1 order-2",as:"router-link",to:{name:"orders-add"}}),a("div",Ee,[a("div",Ke,[t(u,{type:"button",icon:"pi pi-download",outlined:"",label:"Unduh",onClick:o[0]||(o[0]=e=>de(e))})]),a("div",Ye,[t(u,{type:"button",icon:"pi pi-download",outlined:""})]),t(me,{class:"w-full md:w-auto"},{default:l(()=>[t(ce,null,{default:l(()=>o[6]||(o[6]=[a("i",{class:"pi pi-search"},null,-1)])),_:1}),t(_,{modelValue:x.value.global.value,"onUpdate:modelValue":o[1]||(o[1]=e=>x.value.global.value=e),placeholder:"Pencarian",fluid:""},null,8,["modelValue"])]),_:1})])])]),empty:l(()=>o[7]||(o[7]=[v(" No order found. ")])),loading:l(()=>o[8]||(o[8]=[v(" Loading order data. Please wait. ")])),default:l(()=>[t(m,{sortable:"",field:"noInvoice",header:"Invoice",class:"min-w-[15rem]"},{body:l(({data:e})=>[v(i(e.invoice),1)]),filter:l(({filterModel:e})=>[t(_,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Invoice"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{sortable:"",field:"user.name",header:"Pelanggan",class:"min-w-[15rem]"},{body:l(({data:e})=>[a("div",Ge,[a("h6",Qe,i(e.user.name),1),a("p",Je,i(e.user.email),1),a("p",{class:"m-0 text-sm text-primary cursor-pointer hover:text-primary-300 transition-all max-w-fit",onClick:ie},[v(i(e.user.phone),1),o[9]||(o[9]=a("i",{class:"pi pi-angle-down ml-2",style:{"font-size":"0.8rem"}},null,-1))]),t(r(X),{ref_key:"opPhone",ref:B},{default:l(()=>[a("div",Xe,[a("div",null,[o[10]||(o[10]=a("h6",{class:"mb-0"},"Opsi Nomor Telepon",-1)),t(w)]),t(fe,null,{default:l(()=>[t(_,{value:e.user.phone,readonly:"",class:"w-[25rem]"},null,8,["value"]),t(pe,null,{default:l(()=>[t(u,{icon:"pi pi-phone"})]),_:1})]),_:2},1024),a("div",Ze,[t(w),o[11]||(o[11]=a("p",{class:"m-0 text-center text-muted-color text-sm"},"Atau",-1)),t(w)]),a("div",et,[o[12]||(o[12]=a("label",{for:"message"},"Kirim Pesan",-1)),t(q,{id:"message"})]),t(u,{icon:"pi pi-send",label:"Kirim Pesan",iconPos:"right"})])]),_:2},1536)])]),filter:l(({filterModel:e})=>[t(_,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Pelanggan"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{sortable:"",header:"Lokasi",filterField:"location",class:"min-w-[24rem]"},{body:l(({data:e})=>[v(i(e.location),1)]),filter:l(({filterModel:e})=>[t(_,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Kota"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{sortable:"",header:"Layanan",filterField:"service.name",class:"min-w-[40rem]"},{body:l(({data:e})=>[t(r(Y),{value:"0"},{default:l(()=>[t(r(G),{value:"1",class:"accordion-table"},{default:l(()=>[t(r(Q),null,{default:l(()=>[a("div",tt,[e.service.full_image_url?(p(),g("img",{key:0,src:e.service.full_image_url,alt:e.service.name,class:"h-6 text-sm font-normal"},null,8,at)):$("",!0),a("span",null,i(e.service.name),1)])]),_:2},1024),t(r(J),null,{default:l(()=>[t(w),t(r(Y),{value:"0"},{default:l(()=>[(p(!0),g(A,null,K(e.problems,(n,V)=>(p(),T(r(G),{key:n.name,value:V},{default:l(()=>[t(r(Q),{class:Ne({"accordion-subheader":e.service.image_url})},{default:l(()=>[v(i(n.name),1)]),_:2},1032,["class"]),t(r(J),{class:"accordion-content"},{default:l(()=>[a("div",ot,[(p(!0),g(A,null,K(n.sub_problem,(y,ye)=>(p(),g("div",{key:ye,class:"w-full"},[a("div",lt,[a("p",nt,"â€¢ Kategori: "+i(y.name),1),a("div",st,[t(z,{class:"inplace-display-full"},{display:l(()=>[a("div",rt,[a("div",null,[a("p",it,"QTY: "+i(y.qty),1),a("p",dt,"Harga: Rp"+i(s.formatPrice(y.price)),1)]),o[13]||(o[13]=a("i",{class:"pi pi-pencil ml-2"},null,-1))])]),content:l(({closeCallback:ge})=>[a("div",ut,[a("div",ct,[o[16]||(o[16]=a("p",{class:"m-0"},"QTY: ",-1)),t(k,{modelValue:y.qty,"onUpdate:modelValue":P=>y.qty=P,inputId:"horizontal-buttons",showButtons:"",buttonLayout:"horizontal",min:0,max:99,inputClass:" text-center border-l border-l-red-500 border-r border-r-green-500 bg-transparent max-w-[4rem]",incrementButtonClass:"border-green-500",decrementButtonClass:"border-red-500",small:""},{incrementbuttonicon:l(()=>o[14]||(o[14]=[a("span",{class:"pi pi-plus"},null,-1)])),decrementbuttonicon:l(()=>o[15]||(o[15]=[a("span",{class:"pi pi-minus"},null,-1)])),_:2},1032,["modelValue","onUpdate:modelValue"])]),a("div",mt,[o[17]||(o[17]=a("p",{class:"m-0"},"Harga: ",-1)),t(k,{modelValue:y.price,"onUpdate:modelValue":P=>y.price=P,type:"text",placeholder:"Masukkan Harga",inputId:"currency-indonesia",mode:"currency",currency:"IDR",locale:"id-ID",minFractionDigits:0},null,8,["modelValue","onUpdate:modelValue"])]),t(u,{label:"Simpan",icon:"pi pi-check",outlined:"",severity:"success",class:"max-w-fit",onClick:ge},null,8,["onClick"])])]),_:2},1024)])])]))),128))])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),t(m,{field:"properties.name",header:"Jenis Property",class:"min-w-[15rem]",sortable:""},{body:l(({data:e})=>[a("div",null,[a("p",pt,i(e.properties.name),1),e.isLadderRequired?(p(),T(ve,{key:0,value:ae(e.isLadderRequired)??"",size:"small",class:"mb-2"},null,8,["value"])):$("",!0),t(z,{class:"inplace-custom-display"},{display:l(()=>[a("p",ft,[v("Rp"+i(s.formatPrice(e.properties.fee)),1),o[18]||(o[18]=a("i",{class:"pi pi-pencil ml-2"},null,-1))])]),content:l(({closeCallback:n})=>[a("div",vt,[t(k,{modelValue:e.properties.fee,"onUpdate:modelValue":V=>e.properties.fee=V,type:"text",placeholder:"Cari Harga",inputId:"currency-indonesia",mode:"currency",currency:"IDR",locale:"id-ID",minFractionDigits:0},null,8,["modelValue","onUpdate:modelValue"]),t(u,{icon:"pi pi-check",outlined:"",severity:"success",onClick:n},null,8,["onClick"])])]),_:2},1024)])]),filter:l(({filterModel:e})=>[t(_,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Property"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{sortable:"",field:"total_fee",header:"Total Harga",class:"min-w-[15rem]"},{body:l(({data:e})=>[e.total_fee?(p(),g("span",_t,"Rp"+i(s.formatPrice(e.total_fee)),1)):(p(),g("span",yt,"Harga belum ditentukan"))]),filter:l(({filterModel:e})=>[t(k,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Harga",inputId:"currency-indonesia",mode:"currency",currency:"IDR",locale:"id-ID",minFractionDigits:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{sortable:"",header:"Status",field:"status",filterMenuStyle:{width:"18rem"},class:"min-w-[20rem]"},{body:l(({data:e})=>[t(I,{value:S(e.status),severity:C(e.status),class:"whitespace-nowrap"},null,8,["value","severity"])]),filter:l(({filterModel:e})=>[t(r(R),{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,options:ee,placeholder:"Pilih",showClear:""},{value:l(n=>[n.value!=null?(p(),T(I,{key:0,value:S(n.value),severity:C(n.value)},null,8,["value","severity"])):$("",!0)]),option:l(n=>[t(I,{value:S(n.option),severity:C(n.option)},null,8,["value","severity"])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),t(m,{sortable:"",field:"paymentMethod",header:"Metode Pembayaran",class:"min-w-[15rem]"},{body:l(({data:e})=>o[19]||(o[19]=[v(" Bank Transfer ")])),filter:l(({filterModel:e})=>[t(r(R),{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,options:te,placeholder:"Pilih",showClear:""},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),t(m,{sortable:"",field:"vendor",header:"Vendor Pilihan",class:"min-w-[15rem]"},{body:l(({data:e})=>{var n;return[t(r(R),{modelValue:f.vendor,"onUpdate:modelValue":o[2]||(o[2]=V=>f.vendor=V),options:r(oe),value:(n=e==null?void 0:e.vendor_id)==null?void 0:n.name,filter:"",optionLabel:"name",placeholder:"Pilih Vendor",class:"w-[15rem]"},null,8,["modelValue","options","value"])]}),filter:l(({filterModel:e})=>[t(_,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Vendor"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{sortable:"",header:"Tanggal Pesanan",filterField:"date",dataType:"date",class:"min-w-[20rem]"},{body:l(({data:e})=>[v(i(ne(e.created_at)),1)]),filter:l(({filterModel:e})=>[t(r(Me),{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{sortable:"",field:"id",header:"Action",bodyClass:"text-center",class:"min-w-[10rem]"},{body:l(({data:e})=>[a("div",gt,[N(t(u,{icon:"pi pi-external-link",severity:"info",text:"",as:"router-link",to:{name:"order-detail",params:{id:e.id}}},null,8,["to"]),[[D,"Detail Pesanan",void 0,{bottom:!0}]]),N(t(u,{icon:"pi pi-send",severity:"success",text:"",onClick:n=>re(e.id)},null,8,["onClick"]),[[D,"Teruskan Pesanan",void 0,{bottom:!0}]]),N(t(u,{icon:"pi pi-times",severity:"danger",text:"",onClick:n=>W(e.id)},null,8,["onClick"]),[[D,"Batalkan",void 0,{bottom:!0}]]),t(r(X),{ref_key:"opCancelConfirm",ref:O,class:"p-0 min-w-[20rem]"},{default:l(()=>[o[21]||(o[21]=a("h6",{class:"mb-2"},"Pembatalan Pesanan",-1)),a("div",bt,[a("div",ht,[o[20]||(o[20]=a("label",{for:"message"},"Beri alasan",-1)),t(q,{modelValue:f.reason,"onUpdate:modelValue":o[3]||(o[3]=n=>f.reason=n),id:"message"},null,8,["modelValue"])]),a("div",Vt,[t(u,{label:"Batal",severity:"secondary",text:"",onClick:o[4]||(o[4]=n=>W(n))}),t(u,{label:"Submit",onClick:n=>se(e.id)},null,8,["onClick"])])])]),_:2},1536)])]),_:1})]),_:1},8,["value","filters","loading"]))]),t(r(Fe))],64)}}});export{Et as default};
