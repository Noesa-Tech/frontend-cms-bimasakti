import{s as xe,a as we}from"./index-4588d029.js";import{s as ke}from"./index-a8581030.js";import{s as Te,a as Ce}from"./index-ca6d5153.js";import{s as Se}from"./index-5fa0ab72.js";import{s as Ie}from"./index-dd710192.js";import{s as Pe}from"./index-3ef02de6.js";import{s as De,a as Ue}from"./index-4ce9966d.js";import{d as Ae,a as V,S as $e,ag as Oe,r as O,V as Y,P as Ne,c as x,f as t,b as o,E as I,J as l,e as s,L as N,z as Re,o as _,N as h,t as u,H as R,M as G,F as Be,D as B,W as c,X as m,ah as He}from"./index-68fdcb85.js";import{s as je,a as Me}from"./index-88605b24.js";import{s as Fe}from"./index-558407c9.js";import{_ as Le}from"./TopBreadcrumb-5dc1b1aa.js";import{s as Q,a as J,b as X,c as Z}from"./index-0e9eedae.js";import{s as qe}from"./index-a2348ffa.js";import{s as H}from"./index-7101df72.js";import{s as We}from"./index-1607d1ac.js";import{s as ee}from"./index-47d794d4.js";import{O as ze}from"./order-20d8f9d0.js";import{V as Ee}from"./vendor-f10637e1.js";import"./index-89e3ea54.js";import"./index-ae0fa429.js";import"./index-83a51394.js";import"./index-23c28282.js";import"./index-620ea49b.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./index-9f6ae4e9.js";const Ke={class:"card mt-8"},Ye={class:"flex flex-col md:flex-row justify-between gap-4"},Ge={class:"flex items-center gap-4 md:order-2 order-1"},Qe={class:"hidden md:flex"},Je={class:"flex md:hidden"},Xe={class:"text-start"},Ze={class:"m-0"},et={class:"m-0 text-sm text-muted-color"},tt={class:"flex flex-col gap-4 w-[25rem]"},at={class:"flex gap-4 items-center"},ot={class:"flex flex-col gap-2"},lt={class:"flex items-center justify-start gap-4"},rt=["src","alt"],nt={class:"flex flex-col items-start text-start gap-4 w-full"},st={class:"flex flex-col gap-1 w-full"},it={class:"m-0 font-semibold"},dt={class:"border rounded-md"},ut={class:"flex items-start justify-between gap-4"},ct={class:"m-0"},mt={class:"m-0"},pt={class:"flex flex-col gap-2 p-2"},ft={class:"flex items-center justify-start gap-2"},vt={class:"flex items-center justify-start gap-2"},_t={class:"m-0"},yt={class:"m-0"},gt={class:"flex items-center gap-2"},ht={key:0},bt={key:1},Vt={class:"flex gap-4 items-center"},xt={class:"flex flex-col gap-4"},wt={class:"flex flex-col gap-2"},kt={class:"flex gap-2 justify-end"},Jt=Ae({__name:"Orders",setup(Tt){const j=V(),M=V(),F=$e(),te=Oe(),L=V(),p=ze(),q=Ee(),w=V(""),W=V(null),y=O({vendor:[],reason:""}),ae=V(0),k=V({global:{value:null,matchMode:c.CONTAINS},noInvoice:{operator:m.AND,constraints:[{value:null,matchMode:c.STARTS_WITH}]},"user.name":{operator:m.AND,constraints:[{value:null,matchMode:c.STARTS_WITH}]},"user.email":{operator:m.AND,constraints:[{value:null,matchMode:c.STARTS_WITH}]},"user.phone":{operator:m.AND,constraints:[{value:null,matchMode:c.STARTS_WITH}]},"service.name":{operator:m.AND,constraints:[{value:null,matchMode:c.STARTS_WITH}]},"properties.name":{operator:m.AND,constraints:[{value:null,matchMode:c.STARTS_WITH}]},location:{operator:m.AND,constraints:[{value:null,matchMode:c.STARTS_WITH}]},vendor:{operator:m.AND,constraints:[{value:null,matchMode:c.STARTS_WITH}]},total_fee:{operator:m.AND,constraints:[{value:null,matchMode:c.STARTS_WITH}]},date:{operator:m.AND,constraints:[{value:null,matchMode:c.DATE_IS}]},status:{operator:m.OR,constraints:[{value:null,matchMode:c.EQUALS}]},paymentMethod:{operator:m.OR,constraints:[{value:null,matchMode:c.EQUALS}]}}),oe=O(["order_confirmed","in_process","on_the_way","work_started","waiting_for_payment","completed"]),le=O(["Transfer Bank","Virtual Account(VA)","GoPay","OVO"]);function P(r){switch(r){case"order_confirmed":return"contrast";case"in_process":return"warn";case"on_the_way":return"info";case"work_started":return"help";case"waiting_for_payment":return"secondary";case"completed":return"success";default:return"default"}}function D(r){switch(r){case"order_confirmed":return"Pesanan Terkonfirmasi";case"in_process":return"Pesanan Diproses";case"on_the_way":return"Menuju Lokasi";case"work_started":return"Sedang Dikerjakan";case"waiting_for_payment":return"Menunggu Pembayaran";case"completed":return"Selesai";default:return"-"}}function re(r){switch(r){case 0:return"Tidak Butuh Tangga";case 1:return"Butuh Tangga";default:return null}}const ne=Y(()=>q.vendors.map(r=>({id:r.id,code:r.id,name:r.name,location:r.address,date:r.created_at,status:r.deleted_at,city:r.city,services:r.vendor_service}))),se=Y(()=>p.allOrder||[]);Ne(async()=>{var a;const r=localStorage.getItem("AuthStore");if(r){const g=JSON.parse(r);w.value=(a=g==null?void 0:g.users)==null?void 0:a.city_id}await p.fetchOrder("order_confirmed",w.value),await q.fetchVendor()});function ie(r){return new Date(r).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"})}const de=r=>{F.require({target:r.currentTarget,message:"Yakin ingin membatalkan pesanan ini?",icon:"pi pi-info-circle",rejectProps:{label:"Batal",severity:"secondary",outlined:!0},acceptProps:{label:"Yakin",severity:"danger"},accept:async()=>{await p.rejectOrder(y.vendor[W.value].id,r,y.reason),await p.fetchOrder("order_confirmed",w.value)},reject:()=>{}})},ue=(r,a)=>{if(y.vendor.length<1)return te.add({severity:"error",summary:"Error",detail:"Vendor belum dipilih"});F.require({target:r.currentTarget,message:`Yakin ingin meneruskan pesanan ini kepada vendor '${y.vendor[a].name}'?`,icon:"pi pi-info-circle",rejectProps:{label:"Batal",severity:"secondary",outlined:!0},acceptProps:{label:"Teruskan",severity:"success"},accept:async()=>{await p.acceptOrder(y.vendor[a].id,r),await p.fetchOrder("order_confirmed",w.value)},reject:()=>{}})},ce=r=>{j.value.toggle(r)},z=r=>{M.value.toggle(event)},me=r=>{L.value.exportCSV()};async function pe(r,a,g,i){let U={_method:"PATCH",qty:a.qty,price:a.price,order_service_id:i};await p.updateOrder(U,g),r(),await p.fetchOrder("order_confirmed",w.value)}async function fe(r,a,g){let i={_method:"PATCH",fee_properties:a};await p.updateOrder(i,g),r(),await p.fetchOrder("order_confirmed",w.value)}return(r,a)=>{const g=Le,i=Te,U=je,b=Fe,ve=Me,f=we,T=He,_e=De,ye=Ue,E=Pe,C=Ie,K=Se,ge=Ce,A=ke,he=xe,$=Re("tooltip");return _(),x(N,null,[t(g,{breadcrumbItems:[{label:"Pesanan"}]}),o("div",Ke,[a[21]||(a[21]=o("div",{class:"font-semibold text-xl mb-4"},"Data Pesanan",-1)),(_(),I(he,{ref_key:"dt",ref:L,key:ae.value,value:s(se),paginator:!0,rows:10,dataKey:"id",filters:k.value,"onUpdate:filters":a[4]||(a[4]=e=>k.value=e),filterDisplay:"menu",loading:s(p).isLoading,globalFilterFields:["noInvoice","user.name","user.email","user.phone","items","location","service.name","properties.name","total_fee","vendor","date","status"],showGridlines:"",scrollable:""},{header:l(()=>[o("div",Ye,[t(i,{type:"button",icon:"pi pi-plus",label:"Tambah Pesanan",class:"md:order-1 order-2",as:"router-link",to:{name:"orders-add"}}),o("div",Ge,[o("div",Qe,[t(i,{type:"button",icon:"pi pi-download",outlined:"",label:"Unduh",onClick:a[0]||(a[0]=e=>me(e))})]),o("div",Je,[t(i,{type:"button",icon:"pi pi-download",outlined:""})]),t(ve,{class:"w-full md:w-auto"},{default:l(()=>[t(U,null,{default:l(()=>a[5]||(a[5]=[o("i",{class:"pi pi-search"},null,-1)])),_:1}),t(b,{modelValue:k.value.global.value,"onUpdate:modelValue":a[1]||(a[1]=e=>k.value.global.value=e),placeholder:"Pencarian",fluid:""},null,8,["modelValue"])]),_:1})])])]),empty:l(()=>a[6]||(a[6]=[h(" No order found. ")])),loading:l(()=>a[7]||(a[7]=[h(" Loading order data. Please wait. ")])),default:l(()=>[t(f,{sortable:"",field:"noInvoice",header:"Invoice",class:"min-w-[15rem]"},{body:l(({data:e})=>[h(u(e.invoice),1)]),filter:l(({filterModel:e})=>[t(b,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Invoice"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(f,{sortable:"",field:"user.name",header:"Pelanggan",class:"min-w-[15rem]"},{body:l(({data:e})=>[o("div",Xe,[o("h6",Ze,u(e.order_name),1),o("p",et,u(e.order_email),1),o("p",{class:"m-0 text-sm text-primary cursor-pointer hover:text-primary-300 transition-all max-w-fit",onClick:ce},[h(u(e.order_phone),1),a[8]||(a[8]=o("i",{class:"pi pi-angle-down ml-2",style:{"font-size":"0.8rem"}},null,-1))]),t(s(ee),{ref_key:"opPhone",ref:j},{default:l(()=>[o("div",tt,[o("div",null,[a[9]||(a[9]=o("h6",{class:"mb-0"},"Opsi Nomor Telepon",-1)),t(T)]),t(ye,null,{default:l(()=>[t(b,{value:e.user.phone,readonly:"",class:"w-[25rem]"},null,8,["value"]),t(_e,null,{default:l(()=>[t(i,{icon:"pi pi-phone"})]),_:1})]),_:2},1024),o("div",at,[t(T),a[10]||(a[10]=o("p",{class:"m-0 text-center text-muted-color text-sm"},"Atau",-1)),t(T)]),o("div",ot,[a[11]||(a[11]=o("label",{for:"message"},"Kirim Pesan",-1)),t(E,{id:"message"})]),t(i,{icon:"pi pi-send",label:"Kirim Pesan",iconPos:"right"})])]),_:2},1536)])]),filter:l(({filterModel:e})=>[t(b,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Pelanggan"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(f,{sortable:"",header:"Lokasi",filterField:"location",class:"min-w-[24rem]"},{body:l(({data:e})=>[h(u(e.location),1)]),filter:l(({filterModel:e})=>[t(b,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Kota"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(f,{sortable:"",header:"Layanan",filterField:"service.name",class:"min-w-[40rem]"},{body:l(({data:e})=>[t(s(Q),{value:"0"},{default:l(()=>[t(s(J),{value:"1",class:"accordion-table"},{default:l(()=>[t(s(X),null,{default:l(()=>[o("div",lt,[e.service.full_image_url?(_(),x("img",{key:0,src:e.service.full_image_url,alt:e.service.name,class:"h-6 text-sm font-normal"},null,8,rt)):R("",!0),o("span",null,u(e.service.name),1)])]),_:2},1024),t(s(Z),null,{default:l(()=>[t(T),t(s(Q),{value:"0"},{default:l(()=>[(_(!0),x(N,null,G(e.problems,(n,d)=>(_(),I(s(J),{key:n.name,value:d},{default:l(()=>[t(s(X),{class:Be({"accordion-subheader":e.service.image_url})},{default:l(()=>[h(u(n.name),1)]),_:2},1032,["class"]),t(s(Z),{class:"accordion-content"},{default:l(()=>[o("div",nt,[(_(!0),x(N,null,G(n.sub_problem,(v,be)=>(_(),x("div",{key:be,class:"w-full"},[o("div",st,[o("p",it,"â€¢ Kategori: "+u(v.name),1),o("div",dt,[t(K,{class:"inplace-display-full"},{display:l(()=>[o("div",ut,[o("div",null,[o("p",ct,"QTY: "+u(v.qty),1),o("p",mt,"Harga: Rp"+u(r.formatPrice(v.price)),1)]),a[12]||(a[12]=o("i",{class:"pi pi-pencil ml-2"},null,-1))])]),content:l(({closeCallback:Ve})=>[o("div",pt,[o("div",ft,[a[15]||(a[15]=o("p",{class:"m-0"},"QTY: ",-1)),t(C,{modelValue:v.qty,"onUpdate:modelValue":S=>v.qty=S,inputId:"horizontal-buttons",showButtons:"",buttonLayout:"horizontal",min:0,max:99,inputClass:" text-center border-l border-l-red-500 border-r border-r-green-500 bg-transparent max-w-[4rem]",incrementButtonClass:"border-green-500",decrementButtonClass:"border-red-500",small:""},{incrementbuttonicon:l(()=>a[13]||(a[13]=[o("span",{class:"pi pi-plus"},null,-1)])),decrementbuttonicon:l(()=>a[14]||(a[14]=[o("span",{class:"pi pi-minus"},null,-1)])),_:2},1032,["modelValue","onUpdate:modelValue"])]),o("div",vt,[a[16]||(a[16]=o("p",{class:"m-0"},"Harga: ",-1)),t(C,{modelValue:v.price,"onUpdate:modelValue":S=>v.price=S,type:"text",placeholder:"Masukkan Harga",inputId:"currency-indonesia",mode:"currency",currency:"IDR",locale:"id-ID",minFractionDigits:0},null,8,["modelValue","onUpdate:modelValue"])]),t(i,{label:"Simpan",icon:"pi pi-check",outlined:"",severity:"success",class:"max-w-fit",onClick:S=>pe(Ve,v,e.id,v.id)},null,8,["onClick"])])]),_:2},1024)])])]))),128))])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),t(f,{field:"properties.name",header:"Jenis Property",class:"min-w-[15rem]",sortable:""},{body:l(({data:e})=>[o("div",null,[o("p",_t,u(e.properties.name),1),e.isLadderRequired?(_(),I(ge,{key:0,value:re(e.isLadderRequired)??"",size:"small",class:"mb-2"},null,8,["value"])):R("",!0),t(K,{class:"inplace-custom-display"},{display:l(()=>[o("p",yt,[h("Rp"+u(r.formatPrice(e.fee_properties)),1),a[17]||(a[17]=o("i",{class:"pi pi-pencil ml-2"},null,-1))])]),content:l(({closeCallback:n})=>[o("div",gt,[t(C,{modelValue:e.fee_properties,"onUpdate:modelValue":d=>e.fee_properties=d,type:"text",placeholder:"Cari Harga",inputId:"currency-indonesia",mode:"currency",currency:"IDR",locale:"id-ID",minFractionDigits:0},null,8,["modelValue","onUpdate:modelValue"]),t(i,{icon:"pi pi-check",outlined:"",severity:"success",onClick:d=>fe(n,e.fee_properties,e.id)},null,8,["onClick"])])]),_:2},1024)])]),filter:l(({filterModel:e})=>[t(b,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Property"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(f,{sortable:"",field:"total_fee",header:"Total Harga",class:"min-w-[15rem]"},{body:l(({data:e})=>[e.total_fee?(_(),x("span",ht,"Rp"+u(r.formatPrice(e.total_fee)),1)):(_(),x("span",bt,"Harga belum ditentukan"))]),filter:l(({filterModel:e})=>[t(C,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Harga",inputId:"currency-indonesia",mode:"currency",currency:"IDR",locale:"id-ID",minFractionDigits:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(f,{sortable:"",header:"Status",field:"status",filterMenuStyle:{width:"18rem"},class:"min-w-[20rem]"},{body:l(({data:e})=>[t(A,{value:D(e.status),severity:P(e.status),size:"small"},null,8,["value","severity"])]),filter:l(({filterModel:e})=>[t(s(H),{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,options:oe,placeholder:"Pilih",showClear:""},{value:l(n=>[n.value!=null?(_(),I(A,{key:0,value:D(n.value),severity:P(n.value)},null,8,["value","severity"])):R("",!0)]),option:l(n=>[t(A,{value:D(n.option),severity:P(n.option)},null,8,["value","severity"])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),t(f,{sortable:"",field:"paymentMethod",header:"Metode Pembayaran",class:"min-w-[15rem]"},{body:l(({data:e})=>a[18]||(a[18]=[h(" Bank Transfer ")])),filter:l(({filterModel:e})=>[t(s(H),{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,options:le,placeholder:"Pilih",showClear:""},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),t(f,{sortable:"",field:"vendor",header:"Vendor Pilihan",class:"min-w-[15rem]"},{body:l(({data:e,index:n})=>{var d;return[t(s(H),{modelValue:y.vendor[n],"onUpdate:modelValue":v=>y.vendor[n]=v,options:s(ne),value:(d=e==null?void 0:e.vendor_id)==null?void 0:d.name,filter:"",optionLabel:"name",placeholder:"Pilih Vendor",class:"w-[15rem]"},null,8,["modelValue","onUpdate:modelValue","options","value"])]}),filter:l(({filterModel:e})=>[t(b,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,type:"text",placeholder:"Cari Vendor"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(f,{sortable:"",header:"Tanggal Pesanan",filterField:"date",dataType:"date",class:"min-w-[20rem]"},{body:l(({data:e})=>[h(u(ie(e.created_at)),1)]),filter:l(({filterModel:e})=>[t(s(qe),{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(f,{sortable:"",field:"id",header:"Action",bodyClass:"text-center",class:"min-w-[10rem]"},{body:l(({data:e,index:n})=>[o("div",Vt,[B(t(i,{icon:"pi pi-external-link",severity:"info",text:"",as:"router-link",to:{name:"order-detail",params:{id:e.id}}},null,8,["to"]),[[$,"Detail Pesanan",void 0,{bottom:!0}]]),B(t(i,{icon:"pi pi-send",severity:"success",text:"",onClick:d=>ue(e.id,n)},null,8,["onClick"]),[[$,"Teruskan Pesanan",void 0,{bottom:!0}]]),B(t(i,{icon:"pi pi-times",severity:"danger",text:"",onClick:d=>(z(e.id),W.value=n)},null,8,["onClick"]),[[$,"Batalkan",void 0,{bottom:!0}]]),t(s(ee),{ref_key:"opCancelConfirm",ref:M,class:"p-0 min-w-[20rem]"},{default:l(()=>[a[20]||(a[20]=o("h6",{class:"mb-2"},"Pembatalan Pesanan",-1)),o("div",xt,[o("div",wt,[a[19]||(a[19]=o("label",{for:"message"},"Beri alasan",-1)),t(E,{modelValue:y.reason,"onUpdate:modelValue":a[2]||(a[2]=d=>y.reason=d),id:"message"},null,8,["modelValue"])]),o("div",kt,[t(i,{label:"Batal",severity:"secondary",text:"",onClick:a[3]||(a[3]=d=>z(d))}),t(i,{label:"Submit",onClick:d=>de(e.id)},null,8,["onClick"])])])]),_:2},1536)])]),_:1})]),_:1},8,["value","filters","loading"]))]),t(s(We))],64)}}});export{Jt as default};
